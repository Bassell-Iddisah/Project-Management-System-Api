{% extends 'app/layout/auth_base.html' %}
{% set text = "Enter your email address and we will send you reset instructions" %}
{% block content %}
    <vue-form :state="forgot_form" @submit.prevent="submit" class="form-horizontal">
        <validate>
            <div class="form-group">
                <label for="email">Email Address</label>
                <input required name="email_address" v-model="model.email_address" type="email" class="form-control"
                       id="email_address"
                       placeholder="Enter Email Address">
            </div>
            <field-messages name="email_address" show="$dirty || $touched"
                            class="form-control-feedback text-danger">
                <span slot="required">Email is a required field</span>
                <span slot="email">Invalid email address</span>
            </field-messages>
        </validate>
        <div class="mt-3">
            <button :disabled="forgot_form.$invalid || processing"
                    class="btn btn-primary btn-block waves-effect waves-light"
                    type="submit">Send
                <span v-if="processing">
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                <span class="sr-only">Loading...</span>
                    </span>
            </button>
        </div>
    </vue-form>
    <script>
        Vue.use(window.VueForm)
        new Vue({
            'el': '#app',
            data: {
                forgot_form: {},
                processing: false,
                model: {
                    email_address: ''
                }
            },
            methods: {
                submit: function () {
                    this.processing = true
                    if (!this.forgot_form.$invalid) {
                        axios.post('{{ url_for("api.auth_forgot_password") }}', this.model).then(({data}) => {
                            Swal.fire({
                                position: 'top-end',
                                title: 'Forgot Password!',
                                type: "success",
                                text: `${data.message}`,
                                showConfirmButton: false,
                                timer: 1800
                            }).then(function () {
                                window.location.reload()
                            })
                        }).catch((error) => {
                            Swal.fire({
                                position: 'top-end',
                                title: 'Error!',
                                type: "error",
                                text: `${error.response.data.message}`,
                                showConfirmButton: false,
                                timer: 1800
                            })
                        })
                    }
                    this.processing = false;
                }
            }, delimiters: ['[[', ']]']
        })
    </script>
{% endblock %}