{% extends 'app/layout/auth_base.html' %}
{% set text = "Login to your account" %}
{% block content %}
    <vue-form :state="login_form" class="form-horizontal" @submit.prevent="submit">
        <validate>
            <div class="form-group">
                <label for="username">Username</label>
                <input v-model="model.username" class="form-control" name="username" placeholder="Enter username"
                       required>
                <field-messages name="username" show="$dirty || $touched"
                                class="form-control-feedback text-danger">
                    <div slot="required">Username is a required field</div>
                </field-messages>
            </div>
        </validate>
        <validate>
            <div class="form-group">
                <label for="password">Password</label>
                <input name="password" required v-model="model.password" type="password" class="form-control"
                       id="password"
                       placeholder="Enter password">
                <field-messages class="form-control-feedback text-danger" name="password" show="$dirty || $touched">
                    <div slot="required">Password is a required field</div>
                </field-messages>
            </div>
        </validate>
        <div class="custom-control custom-checkbox">
            <input v-model="model.rem" type="checkbox" class="custom-control-input" id="customControlInline">
            <label class="custom-control-label" for="customControlInline">Remember me</label>
        </div>

        <div class="mt-3">
            <button :disabled="login_form.$invalid || processing"
                    class="btn btn-primary btn-block waves-effect waves-light"
                    type="submit">Log In
                <span v-if="processing">
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                <span class="sr-only">Loading...</span>
                    </span>
            </button>
        </div>

        <div class=" mt-4 text-center">
            <a href="{{ url_for('auth.forgot_pwd') }}" class="text-muted"><i class="mdi mdi-lock mr-1"></i> Forgot
                password?</a>
            |
            <a href="{{ url_for('auth.register') }}" class="text-muted"><i class="mdi mdi-account mr-1"></i>Register</a>
            |
            <a href="{{ url_for('auth.resend_conf') }}" class="text-muted"><i class="mdi mdi-restart mr-1"></i>Resend Confirmation</a>
        </div>
    </vue-form>
    <script>

        Vue.use(window.VueForm)
        new Vue({
            el: '#app',
            data: {
                login_form: {},
                processing: false,
                model: {
                    username: '',
                    password: '',
                    rem: false
                }
            },
            methods: {
                submit: function () {
                    this.processing = true
                    if (!this.login_form.$invalid) {
                        axios.post('{{ url_for("api.auth_login") }}', this.model).then((data) => {
                            //login user
                        }).catch((error) => {
                            Swal.fire({
                                position: 'top-end',
                                title: 'Error!',
                                type: "error",
                                text: `${error.response.data.message}`,
                                showConfirmButton: false,
                                timer: 1900
                            })
                            this.model.password = "";
                        })
                    }
                    this.processing = false
                }

            },
            delimiters: ['[[', ']]']
        });
    </script>
{% endblock %}