{% extends 'app/layout/auth_base.html' %}
{% set text='Sorry if you didnt receive an account  confirm email, kindly request it again' %}
{% block content %}
    <vue-form class="form-horizontal" @submit.prevent="submit" :state="resend_form">
        <validate :custom="{'checkMail':checkMail}">
            <div class="form-group">
                <label for="email_address">Email Address</label>
                <input required name="email_address" v-model="model.email_address" type="email" class="form-control"
                       id="email_address" placeholder="Enter Email Address">
                <field-messages name="email_address" show="$dirty || $touched"
                                class="form-control-feedback text-danger">
                    <div slot="required">Email is a required field</div>
                    <div slot="email">Invalid email address</div>
                    <div slot="checkMail">Email Address not found</div>
                </field-messages>
            </div>
        </validate>
        <div class="mt-3">
            <button :disabled="resend_form.$invalid || processing"
                    class="btn btn-primary btn-block waves-effect waves-light"
                    type="submit">Resend
                <span v-if="processing">
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                <span class="sr-only">Loading...</span>
                    </span>
            </button>
        </div>
    </vue-form>
    <script>
        Vue.use(window.VueForm)
        new Vue({
            'el': '#app',
            methods: {
                submit: function () {
                    this.processing = true
                    if (!this.resend_form.$invalid) {
                        axios.post("{{ url_for('api.auth_resend_account_activation') }}", this.model).then(({data}) => {
                            Swal.fire({
                                position: 'top-end',
                                title: 'Resending..!',
                                type: "success",
                                text: `${data.message}`,
                                confirmButtonText: 'Ok',
                            }).then(() => {
                                window.location.reload()
                            })
                        }).catch((error) => {
                            Swal.fire({
                                position: 'top-end',
                                title: 'Error!',
                                type: "error",
                                text: `${error.response.data.message}`,
                                confirmButtonText: 'Ok',
                            })

                        })
                    }
                    this.processing = false
                },
                checkMail: function (val) {
                    return new Promise(((resolve, reject) => {
                        axios.post("{{ url_for('api.auth_email_resource') }}", {'email_address': val}).then(({data}) => {
                            resolve(false)
                        }).catch(() => {
                            resolve(true)
                        })
                    }))
                }
            },
            data: {
                resend_form: {},
                processing: false,
                model: {
                    email_address: ''
                }
            }
        })
    </script>
{% endblock %}